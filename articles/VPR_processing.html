<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VPR_processing • vprr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="VPR_processing">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vprr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/sharing_vpr_data.html">Sharing VPR Data</a>
    </li>
    <li>
      <a href="../articles/VPR_processing.html">VPR_processing</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>VPR_processing</h1>
                        <h4 data-toc-skip class="author">Emily O’Grady,
Kevin Sorochan, Catherine Johnson</h4>
            
      

      <div class="hidden name"><code>VPR_processing.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://eogrady21.github.io/vprr/">vprr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="section-1-background">Section 1: Background<a class="anchor" aria-label="anchor" href="#section-1-background"></a>
</h2>
<p>This document was produced at Bedford Institute of Oceanography (BIO)
to accompany the vprr package, a processing and visualization package
for data obtained from the Digital Auto Video Plankton Recorder (VPR)
produced by SeaScan Inc. The VPR consists of a CPU, CTD, and camera
system with different optical settings (i.e., magnifications). It
captures underwater images and records their corresponding salinity,
temperature, and depth. The vprr package functions to join environmental
and plankton data derived from the CTD and camera, respectively, and
calculate plankton concentration and averaged environmental variables
along the path of the VPR. The package does not include automated image
classification; however, there is an optional manual classification
module, which can be used to review and correct outputs from automated
image classification while providing a record of any
(re)classifications.</p>
<p>The VPR outputs two raw files (.dat and .idx) for a given time period
in a deployment. These files are processed together in a software
provided with the VPR (i.e., AutoDeck), which decompresses the images,
extracts “regions of interest” (ROIs), and outputs ROI image files and a
corresponding CTD data file (.dat). The ROI file names are numeric
consisting of 10 digits. The first 8 digits correspond to the number of
milliseconds elapsed in the day at the time the image was captured. The
last two digits correspond to the ROI identifier (01-99). The ROIs and
corresponding CTD data are linked by their 8 digit time stamp. After the
ROIs have been extracted from the raw files they may be sorted into
categories manually or by an automated classification procedure. In
vprr, file naming conventions and directory structures are inherited
from a VPR image classification and analysis software, Visual Plankton.
However, the functionality of vprr is not dependent on the use of Visual
Plankton.</p>
<p>The data inputs for processing in vprr consist of the following file
types: aid (.txt), aidmeas (.txt), and CTD (.dat). The aid and aidmeas
files are derived from separate image classification and measurement
steps outside of vprr. Each “aid” (i.e., autoid) file contains file
paths to individual ROIs that have been classified to the category of
interest. The corresponding “aidmeas” file contains morphological data
for the ROIs (e.g., long axis length, perimeter, etc.).</p>
<div class="float">
<img src="vprr_figure1.PNG" style="width:100.0%" alt="Figure 1. VPR data processing flow chart. Blue boxes represent software and processes, green ovals represent data products. Starting at the top left, data flows through multiple workflows, with the final product being, ecologically significant data."><div class="figcaption">Figure 1. VPR data processing flow chart. Blue
boxes represent software and processes, green ovals represent data
products. Starting at the top left, data flows through multiple
workflows, with the final product being, ecologically significant
data.</div>
</div>
</div>
<div class="section level2">
<h2 id="section-2-summary-of-vprr-data-processing-steps">Section 2: Summary of vprr data processing steps<a class="anchor" aria-label="anchor" href="#section-2-summary-of-vprr-data-processing-steps"></a>
</h2>
<p>The processing steps performed in vprr are detailed in Figure 2,
along with the associated data outputs.</p>
<div class="float">
<img src="vprr_figure2.PNG" style="width:100.0%" alt="Figure 2. Processing steps in R using vprr. Data flows from the top, through multiple layers of processing, including image copying, manual classification and processing calculations."><div class="figcaption">Figure 2. Processing steps in R using vprr. Data
flows from the top, through multiple layers of processing, including
image copying, manual classification and processing calculations.</div>
</div>
<div class="section level5">
<h5 id="processing-environment">Processing Environment<a class="anchor" aria-label="anchor" href="#processing-environment"></a>
</h5>
<p>Before beginning data processing with vprr, it is recommended that a
processing environment be created containing commonly used variables and
file paths. The simplest and most reproducible way to achieve this is to
write an R script where all the mission and system specific variables
are contained, then save the environment as a RData file to be loaded at
the start of any processing scripts. This processing environment
contains reference to a station identifier csv file which should be
created for each mission. This file links station names from deck sheets
to the day and hour values assigned by AutoDeck. Day and hour values
represent the Julian day (3 digit) and two digit hour (24 hour clock)
when sampling was done. Note that the day and hour values will be in the
time zone of the computer used to run AutoDeck. Ensure that this matches
the time zone of the VPR CPU at the time of data collection to avoid a
time offset between data sources.</p>
<p>Another important part of setting up the processing environment is
ensuring the proper directory structure is in place, see Appendix 1 for
details on the required directory structure.</p>
<pre><code><span><span class="co">#### set VPR processing environment --------------------------------------</span></span>
<span></span>
<span><span class="co"># setwd('~/COR2019002/')</span></span>
<span><span class="va">day</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'222'</span>, <span class="st">'222'</span><span class="op">)</span> <span class="co"># 3 digits</span></span>
<span><span class="va">hr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'03'</span>, <span class="st">'04'</span><span class="op">)</span> <span class="co"># 2 digits</span></span>
<span><span class="va">cast</span> <span class="op">&lt;-</span> <span class="st">'5'</span> <span class="co"># chr</span></span>
<span><span class="va">station</span> <span class="op">&lt;-</span> <span class="st">'Example'</span> <span class="co"># chr</span></span>
<span><span class="va">cruise</span> <span class="op">&lt;-</span> <span class="st">'COR2019002'</span> <span class="co"># chr</span></span>
<span><span class="va">opticalSetting</span> <span class="op">&lt;-</span> <span class="st">'S2'</span> <span class="co"># chr</span></span>
<span><span class="va">dh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'d'</span>, <span class="va">day</span>, <span class="st">'.h'</span>, <span class="va">hr</span><span class="op">)</span></span>
<span><span class="va">station_of_interest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'vpr'</span>, <span class="va">cast</span>, <span class="st">'_'</span>, <span class="va">station</span><span class="op">)</span></span>
<span><span class="va">binSize</span> <span class="op">&lt;-</span> <span class="fl">3</span> <span class="co"># num (metres)</span></span>
<span><span class="va">imageVolume</span> <span class="op">&lt;-</span> <span class="fl">41439</span> <span class="co"># num</span></span>
<span><span class="va">year</span> <span class="op">&lt;-</span> <span class="st">'2019'</span> <span class="co"># chr</span></span>
<span></span>
<span><span class="co"># location for new autoid folder</span></span>
<span><span class="va">new_autoid</span> <span class="op">&lt;-</span> <span class="st">'new_autoid/'</span></span>
<span><span class="co"># location of original ROIs</span></span>
<span><span class="va">roi_path</span> <span class="op">&lt;-</span> <span class="st">'extdata/'</span></span>
<span><span class="co"># location of CNN aid files</span></span>
<span><span class="va">manual_class_basepath</span> <span class="op">&lt;-</span> <span class="st">'extdata/COR2019002/autoid'</span></span>
<span><span class="co"># location of manual classification records</span></span>
<span><span class="va">manual_record_path</span> <span class="op">&lt;-</span> <span class="st">'extdata/COR2019002/manual_reclassification_record/'</span></span>
<span><span class="co"># location of CTD data</span></span>
<span><span class="va">castdir</span> <span class="op">&lt;-</span> <span class="st">'extdata/COR2019002/rois/vpr5/d222'</span></span>
<span><span class="co"># get categories</span></span>
<span><span class="va">categories</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">new_autoid</span>, include.dirs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save processing environment</span></span>
<span><span class="co"># save.image(file = paste0(cruise, "env.RData"))</span></span></code></pre>
<p>Once this environment is set, it can be loaded into any processing
session by using</p>
<pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">'COR2019002_env.RData'</span><span class="op">)</span> <span class="co"># where COR2019002 is cruise name</span></span></code></pre>
<p>If sharing processing code with colleagues on version control,
keeping the environment variables separate (outside of the git project)
will allow collaboration while avoiding inconsistencies in file paths or
folder names.</p>
</div>
<div class="section level5">
<h5 id="image-copying-optional">Image Copying (optional):<a class="anchor" aria-label="anchor" href="#image-copying-optional"></a>
</h5>
<p>ROIs are organized into folders corresponding to their assigned
classification categories from automated image classification. The
information in each aid file is used to create a folder of images that
have been classified to that category. This step is only required if
manual re-classification (see Section 2.2) is intended. Further details
on image copying are provided in Section 3.</p>
</div>
<div class="section level5">
<h5 id="manual-re-classification-optional">Manual re-classification (optional):<a class="anchor" aria-label="anchor" href="#manual-re-classification-optional"></a>
</h5>
<p>Automated classifications from are manually checked, which allows for
manual correction and addition of categories not previously used for
automated classification. ROIs that have been copied are manually sorted
to correct for misclassifications. Updated aid and aidmeas files are
produced. Further details on manual re-classification are provided in
Section 4.</p>
</div>
<div class="section level5">
<h5 id="data-processing">Data Processing:<a class="anchor" aria-label="anchor" href="#data-processing"></a>
</h5>
<p>Data outputs including CTD (.dat files), automated classifications
(aid files) and measurements (aidmeas files) are joined together. The
aid and aidmeas files, which may have been updated, are joined with CTD
text files by the 8 digit time stamp (ROI number). The data are then
averaged in user-defined vertical bins to produce a time series of
plankton concentrations and environmental variables. Quality controlled
data products (before and after binning) are then exported in simple
formats (csv, RData, oce) for plotting and analysis. Further details on
data processing are provided in Section 5.</p>
</div>
</div>
<div class="section level2">
<h2 id="section-3-image-copying">Section 3: Image Copying<a class="anchor" aria-label="anchor" href="#section-3-image-copying"></a>
</h2>
<p>In this step, ROIs are copied to folders that are organized based on
the day and hour of data collection and classification category assigned
from automated classification (see Appendix 1: ‘Image Folders’). The
images are organized by AutoDeck into day and hour; however,
reorganizing them based on classification allows easier human
interaction with the data and visual inspection of classifications.
Moreover, this directory structure is used by the next step of
processing (i.e., manual re-classification). To implement this step use
the function <code><a href="../reference/vpr_autoid_copy.html">vprr::vpr_autoid_copy()</a></code> For more information
on input variables, please see documentation for
<code><a href="../reference/vpr_autoid_copy.html">vpr_autoid_copy()</a></code></p>
<pre><code><span><span class="co">#### run image organization -----------------------------------------------</span></span>
<span><span class="fu"><a href="../reference/vpr_autoid_copy.html">vpr_autoid_copy</a></span><span class="op">(</span>new_autoid <span class="op">=</span> <span class="va">new_autoid</span>,</span>
<span>            roi_path <span class="op">=</span> <span class="va">roi_path</span>,</span>
<span>            day <span class="op">=</span> <span class="va">day</span>,</span>
<span>            hour <span class="op">=</span> <span class="va">hr</span>,</span>
<span>            cast <span class="op">=</span> <span class="va">cast</span>,</span>
<span>            station <span class="op">=</span> <span class="va">station</span>,</span>
<span>            org <span class="op">=</span> <span class="st">'dayhour'</span></span>
<span>            <span class="op">)</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="section-4-manual-re-classification">Section 4: Manual Re-classification<a class="anchor" aria-label="anchor" href="#section-4-manual-re-classification"></a>
</h2>
<p>Manual re-classification of some categories after automated
classification may be required to achieve identification accuracy
standards. In this step, ROIs are displayed on the screen one at a time
for manual verification. If an image has been misclassified or if it
falls into a new user-defined category (described below), the image can
be re-classified. This is especially useful for classification of rare
categories that were not defined prior to automated classification.
After completing manual re-classification for a day-hour set, new aid
and aidmeas files are created for new categories, which are identical in
format to original aid and aidmeas files.</p>
<div class="section level3">
<h3 id="section-4-1-preparing-the-environment-by-setting-some-variables">Section 4.1: Preparing the environment by setting some
variables<a class="anchor" aria-label="anchor" href="#section-4-1-preparing-the-environment-by-setting-some-variables"></a>
</h3>
<ul>
<li><p>Load the processing environment, which includes the
<code>basepath</code> variable.</p></li>
<li><p>Set day and hour of interest.</p></li>
<li><p>(optional) Set category of interest. These categories are the
existing automated classification categories which require manual
re-classification, as well as any new categories. The
<code><a href="../reference/vpr_category_create.html">vprr::vpr_category_create()</a></code> function sets up the folder
structure for any new categories which have been added to the list of
interest.</p></li>
<li><p>Note that if you create new categories part way through manual
classification, no misclassified files will have been created in this
category for hours which you have already processed. This may cause some
unexpected errors down the line in processing, you could either
reprocess previous hours of data with all the new categories or manually
create empty misclassified files.</p></li>
<li><p>Run manual re-classification with
<code><a href="../reference/vpr_manual_classification.html">vprr::vpr_manual_classification()</a></code>. This function has a few
optional arguments to customize the manual re-classification experience,
notably <code>gr</code> which is a logical value determining whether or
not manual re-classification options appear as pop ups or in the
console, as well as <code>img_bright</code>, a logical which determines
whether or not the original image is appended with an extra bright
version of the image. Having a bright version of the image allows the
user to see the outline of the organism better, any thin appendages
become more clear and gelatinous organisms like chaetognaths or
ctenophores are easier to distinguish.</p></li>
<li>
<p>The threshold argument in
<code><a href="../reference/vpr_manual_classification.html">vpr_manual_classification()</a></code> can be used to determine the
minimum automated classification confidence required for images to be
passed through without manual verification.</p>
<pre><code><span><span class="co">#### MANUAL RE-CLASSIFICATION -------------------------------------</span></span>
<span><span class="co"># Once automated classification is complete</span></span>
<span><span class="co"># verify classification accuracy by manually </span></span>
<span><span class="co"># looking through select images</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">'COR2019002_env.RData'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># category_new &lt;-</span></span>
<span><span class="co">#   c(</span></span>
<span><span class="co">#     "veliger_gastropod"</span></span>
<span><span class="co">#     )</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># add new category</span></span>
<span><span class="co"># vprr::vpr_category_create(taxa = category_new, basepath = auto_id_folder)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/vpr_manual_classification.html">vpr_manual_classification</a></span><span class="op">(</span>day <span class="op">=</span> <span class="va">day</span>,</span>
<span>                  hour <span class="op">=</span> <span class="va">hr</span>,</span>
<span>                  basepath <span class="op">=</span> <span class="va">manual_class_basepath</span>,</span>
<span>                  gr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="section-4-2-generate-new-aid-and-aidmeas-files">Section 4.2: Generate new aid and aidmeas files<a class="anchor" aria-label="anchor" href="#section-4-2-generate-new-aid-and-aidmeas-files"></a>
</h3>
<p>The function <code><a href="../reference/vpr_manual_classification.html">vprr::vpr_manual_classification()</a></code> produces
two files (‘misclassified’ and ‘re-classified’ text files) as a record
of manual re-classification, which are found in the R project working
directory in folders named by the day and hour that the data were
collected. The function <code><a href="../reference/vpr_autoid_create.html">vprr::vpr_autoid_create()</a></code> takes
these files and outputs new aid and aidmeas files in the R working
directory in folders named by classification category. This step should
be run after each hour of data is manually re-classified. If aidmeas
files have not been created (through a separate measurement workflow),
these functions will run on just the aid files without issue.</p>
<pre><code><span><span class="co">#### REORGANIZE ROI AND ROIMEAS DATA ---------------------------------------</span></span>
<span><span class="co"># get mis/re classified files</span></span>
<span><span class="va">manual_record</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">manual_record_path</span>, <span class="va">dh</span><span class="op">)</span>, </span>
<span>        full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">misclassified</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="va">manual_record</span>, </span>
<span>      pattern <span class="op">=</span> <span class="st">"misclassified"</span>,</span>
<span>      value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">reclassify</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="va">manual_record</span>, pattern <span class="op">=</span> <span class="st">"reclassify"</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># MOVE ROIS THAT WERE MISCLASSIFIED INTO CORRECT FILES &amp; REMOVE MISCLASSIFIED ROIS</span></span>
<span><span class="fu"><a href="../reference/vpr_autoid_create.html">vpr_autoid_create</a></span><span class="op">(</span><span class="va">reclassify</span>, <span class="va">misclassified</span>, <span class="va">manual_class_basepath</span>,</span>
<span>      mea <span class="op">=</span> <span class="cn">FALSE</span>, categories <span class="op">=</span> <span class="va">categories</span><span class="op">)</span></span></code></pre>
<p>The aid and aidmeas files are both text files which are specifically
formatted to record classification outputs for further processing. The
format and naming conventions of these files has been inherited from a
VPR image classification and data processing tool called Visual Plankton
(written in Matlab); however, the functionality of vprr is independent
from that of Visual Plankton. The aid files are text records of image
paths, where each individual text file represents a classification
category. Each line of the aid file is the full path to an image which
was classified into the designated category. Note that the naming scheme
of aid files does not include the category name in the file title and
the category is only identifiable by the folder in which it is located.
For example the ‘krill’ classification aid file might be named
‘oct10_1svmaid.d224.h01’ but be located within the ‘krill’ autoid
folder. The aidmeas files are also text files which represent a variety
of different measurements taken of the object(s) within a ROI image. The
columns of the aidmeas files are c(‘Perimeter’, ‘Area’, ‘width1’,
‘width2’, ‘width3’, ‘short_axis_length’, ‘long_axis_length’). The
aidmeas files were originally created during processing with Visual
Plankton but are not created or required for processing with
<code>vprr</code>. We have begun development of an ImageJ workflow which
will create an equivalent product.</p>
<p>Examples of each of these files can be found below.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">aid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/COR2019002/autoid/bad_image_blurry/aid/sep20_2svmaid.d222.h04"</span>,</span>
<span>                                     package <span class="op">=</span> <span class="st">'vprr'</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">aid</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                                                       V1</span></span>
<span><span class="co">#&gt; 1 c:\\data\\cruise_COR2019002\\rois\\vpr5\\d222\\h04\\roi.2521078400.tif</span></span>
<span><span class="co">#&gt; 2 c:\\data\\cruise_COR2019002\\rois\\vpr5\\d222\\h04\\roi.2521624700.tif</span></span>
<span><span class="co">#&gt; 3 c:\\data\\cruise_COR2019002\\rois\\vpr5\\d222\\h04\\roi.2521966500.tif</span></span>
<span><span class="co">#&gt; 4 c:\\data\\cruise_COR2019002\\rois\\vpr5\\d222\\h04\\roi.2522439500.tif</span></span>
<span><span class="co">#&gt; 5 c:\\data\\cruise_COR2019002\\rois\\vpr5\\d222\\h04\\roi.2523322300.tif</span></span>
<span><span class="co">#&gt; 6 c:\\data\\cruise_COR2019002\\rois\\vpr5\\d222\\h04\\roi.2524341800.tif</span></span>
<span></span>
<span><span class="va">aidmeas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/COR2019002/autoid/bad_image_blurry/aidmea/sep20_2svmaid.mea.d222.h04"</span>,</span>
<span>                                 package <span class="op">=</span> <span class="st">'vprr'</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">aidmeas</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "    166.37    807.00     10.44     11.40     31.95     32.64     48.20"</span></span>
<span><span class="co">#&gt; [2] "    318.94   3737.00     29.07     36.12     32.06     50.60    113.08"</span></span>
<span><span class="co">#&gt; [3] "    246.51   1370.00     14.32     14.32     13.60     19.66    106.03"</span></span>
<span><span class="co">#&gt; [4] "    563.24   6062.00     38.48     72.45     36.24     85.87    166.81"</span></span>
<span><span class="co">#&gt; [5] "    162.91    649.00      9.49      6.08     11.18     14.57     70.70"</span></span>
<span><span class="co">#&gt; [6] "    228.94   1723.00     22.80     21.93     15.81     27.31     93.59"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="section-4-3-file-check">Section 4.3: File check<a class="anchor" aria-label="anchor" href="#section-4-3-file-check"></a>
</h3>
<p>The last step of manual re-classification includes some manual file
organization and final checks. These files should be manually
reorganized in a new directory which will become the new auto_id_folder
(see Appendix 1: Directory Structure). Any aid and aidmeas files from
categories which were not manually checked and re-classified should also
be added to this new auto_id_folder if they are to be included in
further processing (e.g., computation of concentration in user-specified
depth bins). After the updated aid and aidmeas files have been manually
reorganized they can be quality controlled using
vprr::vpr_autoid_check(). The user could also manually check the
files.</p>
<pre><code><span><span class="co">#### FILE CHECK ----------------------------------------------------------</span></span>
<span><span class="co"># (outputs text file in working directory with check data)</span></span>
<span><span class="fu"><a href="../reference/vpr_autoid_check.html">vpr_autoid_check</a></span><span class="op">(</span><span class="va">new_autoid</span>, original_autoid <span class="op">=</span> <span class="va">manual_class_basepath</span>, </span>
<span>             cruise <span class="op">=</span> <span class="va">cruise</span>, dayhours <span class="op">=</span> <span class="va">dh</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="section-5-data-processing">Section 5: Data Processing<a class="anchor" aria-label="anchor" href="#section-5-data-processing"></a>
</h2>
<p>This is the main chunk of coding required to generate data products.
This step does not require image copying (Section 3) or manual
re-classification (Section 4) steps; however, if these steps were taken
the aid and aidmeas files generated from manual re-classification and
integrated into the directory structure (as specified in Section 4) are
used as an input. The following is a walk-through of processing data
from a DFO field mission (i.e. mission COR2019002) in the southern Gulf
of St. Lawrence in 2019. First, all libraries should be loaded and the
processing environment, described in Section 2.4 should be loaded.</p>
<pre><code><span><span class="co">##### PROCESSING  ---------------------------------------------------------</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://eogrady21.github.io/vprr/">vprr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">#### FILE PATHS &amp; SETTINGS ------------------------------------------------</span></span>
<span><span class="co"># loads processing environment specific to user</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">'COR2019002_env.RData'</span><span class="op">)</span></span></code></pre>
<p>CTD data are loaded in using <code><a href="../reference/vpr_ctd_read.html">vprr::vpr_ctd_read</a></code>. During
CTD data read in, a seawater density variable <code>sigmaT</code> is
derived using the function <code><a href="https://dankelley.github.io/oce/reference/swSigmaT.html" class="external-link">oce::swSigmaT</a></code>, and
<code>depth</code> (in meters) is derived from pressure using the
function <code><a href="https://dankelley.github.io/oce/reference/swDepth.html" class="external-link">oce::swDepth</a></code>. For more information on the
<code>oce</code> package, see <code>dankelley/oce</code> on GitHub.</p>
<pre><code><span><span class="co">#### READ CTD DATA --------------------------------------------------------</span></span>
<span><span class="va">ctd_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">castdir</span>, pattern <span class="op">=</span> <span class="st">'.dat'</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">ctd_dat_combine</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vpr_ctd_read.html">vpr_ctd_read</a></span><span class="op">(</span></span>
<span>  <span class="va">ctd_files</span>,</span>
<span>  <span class="va">station_of_interest</span>,</span>
<span>  col_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"time_ms"</span>,</span>
<span>    <span class="st">"conductivity"</span>,</span>
<span>    <span class="st">"temperature"</span>,</span>
<span>    <span class="st">"pressure"</span>,</span>
<span>    <span class="st">"salinity"</span>,</span>
<span>    <span class="st">"reserved_mv"</span>,</span>
<span>    <span class="st">"turbidity_mv"</span>,</span>
<span>    <span class="st">"fluorescence_mv"</span>,</span>
<span>    <span class="st">"oxygen_mV"</span>,</span>
<span>    <span class="st">"pitch_degrees"</span>,</span>
<span>    <span class="st">"roll_degrees"</span>,</span>
<span>    <span class="st">"frame_number"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
<p>The aid (and aidmeas) files, which reflect manual classification (if
used, see Section 4), are then found</p>
<pre><code><span><span class="co">##### FIND VPR DATA FILES ---------------------------------------------</span></span>
<span><span class="co"># find aid files </span></span>
<span><span class="va">auto_id_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">new_autoid</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Path to aid for each category</span></span>
<span><span class="va">aid_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">auto_id_path</span>, <span class="st">'/aid/'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># AUTO ID FILES</span></span>
<span><span class="va">aid_file_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dh</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">aid_file_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">aid_path</span>, pattern <span class="op">=</span> <span class="va">dh</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">aid_file_list_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">aid_file_list</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">remove</a></span><span class="op">(</span><span class="va">aid_file_list</span>, <span class="va">aid_path</span><span class="op">)</span> <span class="co"># tidy up environment</span></span>
<span></span>
<span><span class="co"># Path to aidmeas for each category</span></span>
<span><span class="va">aidmeas_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">auto_id_path</span>, <span class="st">'/aidmea/'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># AUTO ID (MEASUREMENT) FILES</span></span>
<span><span class="va">aidmea_file_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dh</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">aidmea_file_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">aidmeas_path</span>, pattern <span class="op">=</span> <span class="va">dh</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">aidmea_file_list_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">aidmea_file_list</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">remove</a></span><span class="op">(</span><span class="va">aidmea_file_list</span>, <span class="va">aidmeas_path</span><span class="op">)</span> <span class="co"># tidy up environment</span></span></code></pre>
<p>aid (and aidmeas) files are read in using
<code><a href="../reference/vpr_autoid_read.html">vprr::vpr_autoid_read()</a></code>.</p>
<pre><code><span>  <span class="co">##### READ ROI DATA -----------------------------------------------------</span></span>
<span>  <span class="va">roi_dat_combine</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vpr_autoid_read.html">vpr_autoid_read</a></span><span class="op">(</span></span>
<span>      file_list_aid <span class="op">=</span> <span class="va">aid_file_list_all</span>,</span>
<span>      export <span class="op">=</span> <span class="st">'aid'</span>,</span>
<span>      station_of_interest <span class="op">=</span> <span class="va">station_of_interest</span>,</span>
<span>      opticalSetting <span class="op">=</span> <span class="va">opticalSetting</span>,</span>
<span>      categories <span class="op">=</span> <span class="va">categories</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#### READ MEASURMENT DATA -----------------------------------------------</span></span>
<span>  <span class="va">meas_dat_combine</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vpr_autoid_read.html">vpr_autoid_read</a></span><span class="op">(</span></span>
<span>      file_list_aid <span class="op">=</span> <span class="va">aid_file_list_all</span>,</span>
<span>      file_list_aidmeas <span class="op">=</span> <span class="va">aidmea_file_list_all</span>,</span>
<span>      export <span class="op">=</span> <span class="st">'aidmeas'</span>,</span>
<span>      station_of_interest <span class="op">=</span> <span class="va">station_of_interest</span>,</span>
<span>      opticalSetting <span class="op">=</span> <span class="va">opticalSetting</span>,</span>
<span>      categories <span class="op">=</span> <span class="va">categories</span></span>
<span>  <span class="op">)</span></span></code></pre>
<p>Next, CTD and aid data are merged to create a data frame describing
both environmental variables (eg. temperature, salinity) and classified
images. The function used is <code><a href="../reference/vpr_ctdroi_merge.html">vprr::vpr_ctdroi_merge()</a></code>.</p>
<pre><code><span><span class="co">##### MERGE CTD AND ROI DATA ------------------------------------------</span></span>
<span><span class="va">ctd_roi_merge</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vpr_ctdroi_merge.html">vpr_ctdroi_merge</a></span><span class="op">(</span><span class="va">ctd_dat_combine</span>, <span class="va">roi_dat_combine</span><span class="op">)</span></span></code></pre>
<p>Before final export of data products, the following variables are
added to the data frame: time in hours (time_hr) is calculated, and a
time stamp (ymdhms) with POSIXct signature in Y-M-D h:m:s format is
added using the function <code>vpr_ctd_ymd</code>.</p>
<pre><code><span><span class="co">##### CALCULATED VARS -------------------------------------------------</span></span>
<span><span class="co"># add time_hr and sigma T data and depth</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">ctd_roi_merge</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">.</span>, time_hr <span class="op">=</span> <span class="va">time_ms</span> <span class="op">/</span> <span class="fl">3.6e+06</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vpr_ctd_ymd.html">vpr_ctd_ymd</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">year</span><span class="op">)</span></span></code></pre>
<p>Average plankton concentration and environmental variables (e.g.,
temperature, salinity, density, etc.) are then computed within a user
defined depth bin. The computation of plankton concentration is
dependent on the assumption that the same animals are not re-sampled by
the instrument. The bin-averaging step standardizes plankton
concentrations when the VPR does not sample the water column evenly.
This can occur due to characteristics of the deployment or variability
in the sampling rate, which is not necessarily constant in older
versions of the VPR. Binning also reduces noise in the data. First, an
oce CTD object is created using <code><a href="../reference/vpr_oce_create.html">vprr::vpr_oce_create()</a></code>.
Then, bin-averaging is done using <code><a href="../reference/bin_cast.html">vprr::bin_cast()</a></code>.
Concentrations are calculated for each category of interest.</p>
<pre><code><span><span class="co">##### BIN DATA AND DERIVE CONCENTRATION ---------------------------------</span></span>
<span><span class="co"># create oce object</span></span>
<span><span class="va">ctd_roi_oce</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vpr_oce_create.html">vpr_oce_create</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># bin and calculate concentration for all category (combined)</span></span>
<span><span class="va">vpr_depth_bin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bin_cast.html">bin_cast</a></span><span class="op">(</span>ctd_roi_oce <span class="op">=</span> <span class="va">ctd_roi_oce</span>,</span>
<span>    binSize <span class="op">=</span>  <span class="va">binSize</span>,</span>
<span>    imageVolume <span class="op">=</span> <span class="va">imageVolume</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># bin and calculate concentrations for each category</span></span>
<span><span class="va">category_conc_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vpr_roi_concentration.html">vpr_roi_concentration</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>    <span class="va">categories</span>,</span>
<span>    <span class="va">station_of_interest</span>,</span>
<span>    <span class="va">binSize</span>,</span>
<span>    <span class="va">imageVolume</span><span class="op">)</span></span>
<span>    </span></code></pre>
<p>Measurement data can also be binned to match the resolution of ROI
data.</p>
<pre><code><span><span class="co">#### BIN SIZE DATA -------------------------------------------------------</span></span>
<span></span>
<span><span class="va">size_df_f</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vpr_ctdroisize_merge.html">vpr_ctdroisize_merge</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>    data_mea <span class="op">=</span> <span class="va">meas_dat_combine</span>,</span>
<span>    category_of_interest <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"krill"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">size_df_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vpr_size_bin.html">vpr_size_bin</a></span><span class="op">(</span><span class="va">size_df_f</span>, bin_mea <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre>
<p>Finally, data are saved as RData and csv files for export and
plotting. Data are also saved as an <code>oce</code> object in order to
preserve both data and metadata in an efficient format. This example
shows gathering metadata from a csv but it could also be input
manually.</p>
<pre><code><span><span class="co">##### SAVE DATA --------------------------------------------------------</span></span>
<span><span class="co">#Metadata (from csv)</span></span>
<span><span class="va">vpr_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">'vpr_metadata_COR2019002.csv'</span><span class="op">)</span></span>
<span><span class="va">vpr_summary_st</span> <span class="op">&lt;-</span> <span class="va">vpr_summary</span><span class="op">[</span><span class="va">vpr_summary</span><span class="op">$</span><span class="va">event</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">cast</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">startlat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vpr_summary_st</span><span class="op">$</span><span class="va">latitudeStart</span><span class="op">)</span></span>
<span><span class="va">stoplat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vpr_summary_st</span><span class="op">$</span><span class="va">latitudeStop</span><span class="op">)</span></span>
<span><span class="va">startlon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vpr_summary_st</span><span class="op">$</span><span class="va">longitudeStart</span><span class="op">)</span></span>
<span><span class="va">stoplon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vpr_summary_st</span><span class="op">$</span><span class="va">longitudeStop</span><span class="op">)</span></span>
<span><span class="va">zstn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vpr_summary_st</span><span class="op">$</span><span class="va">soundingStart</span><span class="op">)</span></span>
<span><span class="va">ddate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vpr_summary_st</span><span class="op">$</span><span class="va">dateStart</span><span class="op">)</span></span>
<span><span class="va">tstart</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vpr_summary_st</span><span class="op">$</span><span class="va">timeStart</span><span class="op">)</span></span>
<span><span class="va">tend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vpr_summary_st</span><span class="op">$</span><span class="va">timeStop</span><span class="op">)</span></span>
<span><span class="va">vpr_comment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vpr_summary_st</span><span class="op">$</span><span class="va">comment</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Save file</span></span>
<span><span class="va">oce_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vpr_save.html">vpr_save</a></span><span class="op">(</span><span class="va">category_conc_n</span>,</span>
<span>      metadata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'deploymentType'</span> <span class="op">=</span> <span class="st">'vprProfile'</span>,</span>
<span>      <span class="st">'waterDepth'</span> <span class="op">=</span> <span class="va">zstn</span>,</span>
<span>      <span class="st">'serialNumber'</span> <span class="op">=</span> <span class="st">'DAVPR-00'</span>,</span>
<span>      <span class="st">'latitudeStart'</span> <span class="op">=</span> <span class="va">startlat</span>,</span>
<span>      <span class="st">'latitudeStop'</span> <span class="op">=</span> <span class="va">stoplat</span>,</span>
<span>      <span class="st">'longitudeStart'</span> <span class="op">=</span> <span class="va">startlon</span>,</span>
<span>      <span class="st">'longitudeStop'</span> <span class="op">=</span> <span class="va">stoplon</span>,</span>
<span>      <span class="st">'castDate'</span> <span class="op">=</span> <span class="va">ddate</span>,</span>
<span>      <span class="st">'castStartTime'</span> <span class="op">=</span> <span class="va">tstart</span>,</span>
<span>      <span class="st">'castEndTime'</span> <span class="op">=</span> <span class="va">tend</span>,</span>
<span>      <span class="st">'processedBy'</span> <span class="op">=</span> <span class="st">'J. Doe'</span>,</span>
<span>      <span class="st">'opticalSetting'</span> <span class="op">=</span> <span class="va">opticalSetting</span>,</span>
<span>      <span class="st">'imageVolume'</span> <span class="op">=</span> <span class="va">imageVolume</span>,</span>
<span>      <span class="st">'comment'</span> <span class="op">=</span> <span class="va">vpr_comment</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># oce data and metadata object</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">savedir</span>, <span class="st">'/oceData_'</span>, <span class="va">station</span>,<span class="st">'.RData'</span><span class="op">)</span>,</span>
<span>    <span class="va">oce_dat</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Save RData files</span></span>
<span><span class="co"># VPR and CTD data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">savedir</span>, <span class="st">'/stationData_'</span>, <span class="va">station</span>,<span class="st">'.RData'</span><span class="op">)</span>,</span>
<span>    <span class="va">data</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># binned data including measurements</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">savedir</span>, <span class="st">'/bin_size_dat_'</span>, <span class="va">station_of_interest</span>,<span class="st">'.RData'</span><span class="op">)</span>,</span>
<span>    <span class="va">size_df_b</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Write csv files</span></span>
<span><span class="co"># VPR and CTD data with concentrations by taxa</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">stdir</span>, <span class="st">'/vpr_data_binned'</span>, <span class="va">station</span>, <span class="st">'.csv'</span><span class="op">)</span>,</span>
<span>    <span class="va">category_conc_n</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># measurement data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">stdir</span>, <span class="st">'/vpr_meas'</span>, <span class="va">station_of_interest</span>, <span class="st">'.csv'</span><span class="op">)</span>,</span>
<span>    <span class="va">roimeas_dat_combine</span><span class="op">)</span> </span></code></pre>
</div>
<div class="section level2">
<h2 id="section-6-disclaimer">Section 6: Disclaimer<a class="anchor" aria-label="anchor" href="#section-6-disclaimer"></a>
</h2>
<p>The functions in vprr were created for a specific project and have
not been tested on a broad range of field mission data. It is possible
that deviations in data format and directory structure from that
described herein may result in errors when using vprr. The vprr package
was developed for the purpose of processing data collected during tow-yo
VPR deployments and image classification. The purpose of this document
is to provide a template for processing and visualizing VPR data that
can be adapted by other users for their own objectives.</p>
</div>
<div class="section level2">
<h2 id="appendix-1-directory-structure">Appendix 1: Directory Structure<a class="anchor" aria-label="anchor" href="#appendix-1-directory-structure"></a>
</h2>
<p>The directory structure required is described below</p>
<ul>
<li>C:/
<ul>
<li>
<p>data</p>
<ul>
<li>
<p>cruise_name</p>
<ul>
<li>
<p>autoid</p>
<ul>
<li>category
<ul>
<li>aid</li>
<li>aidmea</li>
<li>image folders</li>
</ul>
</li>
</ul>
</li>
<li>
<p>rois</p>
<ul>
<li>vprtow#
<ul>
<li>day
<ul>
<li>hour</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>trrois</p>
<ul>
<li>vprtow#
<ul>
<li>day
<ul>
<li>hour</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>This is your project directory, where your R scripts and work
products will be stored:</p>
<ul>
<li>…
<ul>
<li><p>VPR_PROJECT</p></li>
<li>
<p>R</p>
<ul>
<li>R scripts/ workflows</li>
</ul>
</li>
<li>
<p>new_autoid</p>
<ul>
<li><p>category</p></li>
<li><p>aid</p></li>
<li><p>aidmea</p></li>
</ul>
</li>
<li>
<p>manual_reclassification_record</p>
<ul>
<li><p>day/hour</p></li>
<li><p>misclassified</p></li>
<li><p>reclassified</p></li>
</ul>
</li>
<li><p>figures</p></li>
<li><p>station names (csv)</p></li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="appendix-2-glossary">Appendix 2: Glossary<a class="anchor" aria-label="anchor" href="#appendix-2-glossary"></a>
</h2>
<p><strong>Aid files</strong> - Visual Plankton style file output text
file, listing file path information for ROI’s of a specific
classification group</p>
<p><strong>AidMeas files (AutoID measurements)</strong> - Visual
Plankton style output text file, listing measurement data for ROI’s of a
specific classification group. Unit is pixels and columns are
‘Perimeter’, ‘Area’, ‘width1’, ‘width2’, ‘width3’, ‘short_axis_length’,
‘long_axis_length’</p>
<p><strong>Auto Deck</strong> - software which pulls plankton images
from Video Plankton Recorder frames based on specific settings</p>
<p><strong>Auto ID</strong> - The automated classification given to an
image from a machine learning algorithm</p>
<p><strong>AutoID files</strong> - Includes both Aid and AidMeas files
as part of automated classifications</p>
<p><strong>BIO</strong> - Bedford Institute of Oceanography, a research
institute in Halifax NS, Canada</p>
<p><strong>Classification category (category)</strong> - A defined group
under which VPR images can be classified, often represents a taxonomic
group (e.g. Krill), but can also be defined by image type
(e.g. ‘bad_image_blurry’), or other (e.g. ‘marine_snow’), should be one
continuous string (no spaces)</p>
<p><strong>CTD</strong> - Conductivity, Temperature and depth sensor
instrument</p>
<p><strong>Day</strong> - Julian calendar day on which VPR data was
collected (three digits)</p>
<p><strong>Hour</strong> - Two digit hour (24 hour clock) describing
time at which VPR data was collected</p>
<p><strong>Image volume</strong> - The measured volume of water captured
within a VPR image. Calculated based on optical setting and VPR
standards. This is based on AutoDeck settings, it is calculated from the
VPR calibration file (unique to each instrument). It will change based
on AutoDeck settings and should be updated with each cruise/ processing
batch. It is measured in cubic mm</p>
<p><strong>Optical Setting</strong> - A VPR setting controlling image
magnification and field of view, which can be S0, S1, S2 or S3, where S0
has the greatest magnification and smallest image volume, and S3 has the
least magnification and largest image volume</p>
<p><strong>ROI</strong> - Region of interest, images identified by
autodeck within VPR frames based on settings defined in autoDeck
program</p>
<p><strong>SeaScan</strong> - Oceanographic instrument manufacturing
company</p>
<p><strong>station</strong> - A named geographic location, where the VPR
was deployed</p>
<p><strong>Tow-yo</strong> - A VPR deployment method where the VPR is
towed behind a vessel while being raised and lowered through the water
column in order to sample over both depth and distance</p>
<p><strong>TRROIS</strong> - Training set of images used to train
machine learning algorithm</p>
<p><strong>VP</strong> - Visual Plankton program, written in Matlab to
classify VPR images</p>
<p><strong>VPR</strong> - Video Plankton Recorder, oceanographic
instrument used to image small volumes of water for the purpose of
capturing images of plankton</p>
<p><strong>vprtow#</strong> - A numeric code which is unique to each VPR
deployment</p>
<p><strong>Working Directory</strong> - File path on your computer that
defines the default location of any files you read into R, or save out
of R</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Emily O’Grady, Kevin Sorochan, Catherine Johnson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
